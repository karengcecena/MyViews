{% extends 'base.html' %}
{% block title %} Media Information{% endblock %}

{% block body %} 

    <nav>
        <ul>
            <li class="medialogo">MyViews</li>
            <!-- <li><a href="/">Home</a></li> -->
            <li><a href="/media-search-results-react">Search</a></li>
            <li><a href="/user-profile">Profile</a></li>
            <li><a href="/search-friends">Friends</a></li>
            <li><a href="/logout">Logout</a></li>
        </ul>
    </nav>


    {% if (media_type == "movie") %}

        <h1>{{data["original_title"]}}</h1>
        <p>{{data["overview"]}}</p>

        {% if user %}

            <img src="https://image.tmdb.org/t/p/original{{ data['poster_path'] }}">
            
            <!-- Rating modal -->
            <!-- Code adapted from https://getbootstrap.com/docs/5.0/components/modal/ -->
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal1">
                Rate Movie
            </button>

            <!-- Modal -->
            <div class="modal fade" id="modal1" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Add a Rating</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="/media-info/movie/{{ TMDB_id }}/rating" method="POST">

                            <!-- star ratings updated:  -->
                            <div class="rating">
                        
                            <!-- score= 0 -->
                            <input type="radio" name="score" value=5 id="5">
                            <label for="5">☆</label>
            
                            <!-- score= 1 -->
                            <input type="radio" name="score" value=4 id="4">
                            <label for="4">☆</label>
            
                            <!-- score= 2 -->
                            <input type="radio" name="score" value=3 id="3">
                            <label for="3">☆</label>
            
                            <!-- score= 3 -->
                            <input type="radio" name="score" value=2 id="2">
                            <label for="2">☆</label>
            
                            <!-- score= 4 -->
                            <input type="radio" name="score" value=1 id="1">
                            <label for="1">☆</label>
                            
                            Have you seen this movie? Rate it: 
            
                            </div>
                        
                            <!-- comment -->
                            Any comments? 
                            <input type="text" name="comment" id="rating">
            
                            <!-- time input to add to watch list -->
                            <label for="watch_time">Enter when you watched it: </label>
                            <input type="date" id="watch_time" name="watch_time" required="required">
                            </label>    
                    </div>
                        <div class="modal-footer">
                            <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
                            <button type="submit" class="btn btn-primary">Add Review</button>
                        </div>
                        </form>
                    </div>
                </div>
                </div>

            
            <!-- Code adapted from https://getbootstrap.com/docs/5.0/components/modal/ -->

            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal2">
                Add to List
            </button>

            <!-- Modal -->
            <div class="modal fade" id="modal2" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Add this movie to a list</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="/movie/{{ TMDB_id }}/sort-folder" method="POST">
                            <!-- Watched List-->
                            <input type="radio" name="list" value="watched" id="watched">
                            <label for="watched">
                                <!-- time input to add to watch list -->
                                <label for="watch_time">Watched List</label>
                                <input type="date" id="watch_time" name="watch_time">
                                </label>
            
                            <!-- To Be Watched List-->
                            <input type="radio" name="list" value="to_be_watched" id="tobeewatched">
                            <label for="tobeewatched">To Be Watched List</label>
            
                    </div>
                        <div class="modal-footer">
                            <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
                            <button type="submit" class="btn btn-primary">Add to List</button>
                        </div>
                        </form>
                    </div>
                </div>
                </div>
        

        <form action="/movie/{{ TMDB_id }}/add-to-playlist" method="POST">

            <label for="playlists">Add your movie to an existing folder:</label>
            <select name="playlist" id="playlists" required="required">
                
                {% for playlist in user.playlists %}
                    <option value="{{ playlist.playlist_id }}">{{ playlist.name }}</option>
                {% endfor %}

            </select>
            <button type="submit">Add To Playlist</button>
            
        </form>

        <!-- display ratings for FRIENDS ONLY:  -->
        
        {% if all_ratings %} 
        <div>
            <div class="row">
            <h1> Ratings: </h1>
    
            {% for rating in all_ratings %}

            <!-- for user to view own rating -->
                <div class="col">
                    {% if rating.user_id == user.user_id %}
                    <h2><a href="/user-profile">{{ rating.user.username }}:</a></h2>
                        {% if rating.score == 1 %}
                            <div class="star">★</div>
                        {% elif rating.score == 2 %}
                            <div class="star">★★</div>
                        {% elif rating.score == 3 %}
                            <div class="star">★★★</div>
                        {% elif rating.score == 4 %}
                            <div class="star">★★★★</div>
                        {% elif rating.score == 5 %}
                            <div class="star">★★★★★</div>
                        {% endif %}

                        {{ rating.review_input }}

                        <!-- give option to delete rating -->
                        <br> 

                        <form action="/media-info/movie/delete-rating" method="POST" class="deleting">
                            <input type="radio" name="rating_id" value="{{ rating.rating_id }}" id="deletingrating" checked>
                            <label for="deletingrating"><button type="submit">Delete Rating</button></label>
                        </form>

                    {% endif %}
                </div>

            <!-- for user to view friend's rating -->
                <div class="col">
                    {% for friend in user.following %}
                        {% if rating.user_id == friend.user_id %}
                        <h2><a href="/display-friend/{{ rating.user.username }}">{{ rating.user.username }}:</a></h2>
                            {% if rating.score == 1 %}
                                <div class="star">★</div>
                            {% elif rating.score == 2 %}
                                <div class="star">★★</div>
                            {% elif rating.score == 3 %}
                                <div class="star">★★★</div>
                            {% elif rating.score == 4 %}
                                <div class="star">★★★★</div>
                            {% elif rating.score == 5 %}
                                <div class="star">★★★★★</div>
                            {% endif %}
                        {{ rating.review_input }}
                        {% endif %} 
                    {% endfor %}
                </div>
            {% endfor %}
            </div>
        </div>
        {% endif %}
        
        
        {% else %}
            <img src="https://image.tmdb.org/t/p/original{{ data['poster_path'] }}">
            <!-- <div><a href="/">Go Back to Homepage</a> or <a href="/search">Search for a different media</a></div> -->

        {% endif %}

    {% elif (media_type == "show") %}

        <h1>{{data["name"]}}</h1>
        <p>{{data["overview"]}}</p>

        {% if user %}
            
            <img src="https://image.tmdb.org/t/p/original{{ data['poster_path'] }}">

            <!-- Code adapted from https://getbootstrap.com/docs/5.0/components/modal/ -->
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                Rate Show
            </button>

            <!-- Modal -->
            <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Add a Rating</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="/media-info/tvshow/{{ TMDB_id }}/rating" method="POST">

                            <!-- star ratings updated:  -->
                            <div class="rating">
                        
                            <!-- score= 0 -->
                            <input type="radio" name="score" value=5 id="5">
                            <label for="5">☆</label>
            
                            <!-- score= 1 -->
                            <input type="radio" name="score" value=4 id="4">
                            <label for="4">☆</label>
            
                            <!-- score= 2 -->
                            <input type="radio" name="score" value=3 id="3">
                            <label for="3">☆</label>
            
                            <!-- score= 3 -->
                            <input type="radio" name="score" value=2 id="2">
                            <label for="2">☆</label>
            
                            <!-- score= 4 -->
                            <input type="radio" name="score" value=1 id="1">
                            <label for="1">☆</label>
                            
                            Have you seen this show? Rating: 
            
                            </div>
                        
                            <!-- comment -->
                            Any comments? 
                            <input type="text" name="comment" id="rating">
            
                            <!-- time input to add to watch list -->
                            <label for="watch_time">Enter when you watched it: </label>
                            <input type="date" id="watch_time" name="watch_time" required="required">
                            </label>
            
                    </div>
                        <div class="modal-footer">
                            <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
                            <button type="submit" class="btn btn-primary">Add Review</button>
                        </div>
                        </form>
                    </div>
                </div>
                </div>


            <form action="/tvshow/{{ TMDB_id }}/sort-folder" method="POST">
                Want to add this show to your list?
                <!-- Watched List-->
                <input type="radio" name="list" value="watched" id="watched">
                <label for="watched">
                    <!-- time input to add to watch list -->
                    <label for="watch_time">Watched List: Enter when you watched it: </label>
                    <input type="date" id="watch_time" name="watch_time">
                    </label>
                <!-- Watched List
                <input type="radio" name="list" value="watched" id="watched">
                <label for="watched">Watched List</label> -->

                <!-- To Be Watched List-->
                <input type="radio" name="list" value="to_be_watched" id="tobeewatched">
                <label for="tobeewatched">To Be Watched List</label>

                <button type="submit">Add to list</button>
                <!-- <input type="submit"> -->
            </form>

            <form action="/tvshow/{{ TMDB_id }}/add-to-playlist" method="POST">

                <label for="playlists">Add your movie to an existing folder:</label>
                <select name="playlist" id="playlists">
                    
                    {% for playlist in user.playlists %}
                        <option value="{{ playlist.playlist_id }}">{{ playlist.name }}</option>
                    {% endfor %}

                </select>
                <button type="submit">Add To Playlist</button>

            </form>

            <!-- display ratings for FRIENDS ONLY:  -->
         
            {% if all_ratings %}
            <div>
                <div class="row">
                <h1> Ratings: </h1>
        
                {% for rating in all_ratings %}

                <!-- for user to view own rating -->
                    <div class="col">
                        {% if rating.user_id == user.user_id %}
                        <h2><a href="/user-profile">{{ rating.user.username }}:</a></h2>
                            {% if rating.score == 1 %}
                                <div class="star">★</div>
                            {% elif rating.score == 2 %}
                                <div class="star">★★</div>
                            {% elif rating.score == 3 %}
                                <div class="star">★★★</div>
                            {% elif rating.score == 4 %}
                                <div class="star">★★★★</div>
                            {% elif rating.score == 5 %}
                                <div class="star">★★★★★</div>
                            {% endif %}

                            {{ rating.review_input }}

                            <!-- give option to delete rating -->
                            <br> 

                            <form action="/media-info/tvshow/delete-rating" method="POST" class="deleting" id="deletingrating_mediapage" >
                                <input type="radio" name="rating_id" value="{{ rating.rating_id }}" id="deletingrating_mediapage" checked>
                                <label for="deletingrating_mediapage"><button type="submit" id="deletingrating_mediapage">Delete Rating</button></label>
                            </form>

                        {% endif %}
                    </div>

                    <!-- for user to view friend's rating -->
                    <div class="col">
                        {% for friend in user.following %}
                            {% if rating.user_id == friend.user_id %}
                            <h2><a href="/display-friend/{{ rating.user.username }}">{{ rating.user.username }}:</a></h2>
                                {% if rating.score == 1 %}
                                    <div class="star">★</div>
                                {% elif rating.score == 2 %}
                                    <div class="star">★★</div>
                                {% elif rating.score == 3 %}
                                    <div class="star">★★★</div>
                                {% elif rating.score == 4 %}
                                    <div class="star">★★★★</div>
                                {% elif rating.score == 5 %}
                                    <div class="star">★★★★★</div>
                                {% endif %}
                                {{ rating.review_input }}
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
                </div>
            </div>
            {% endif %}

        {% else %}
            <img src="https://image.tmdb.org/t/p/original{{ data['poster_path'] }}">
            <!-- <div><a href="/" >Go Back to Homepage</a> or <a href="/search">Search for a different media</a></div> -->

        {% endif %}
    {% endif %}

{% endblock %}